name: Gemini AI Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Gemini Code Reviewer
        # Utilizando uma action compatível com modelos Google
        uses: google-gemini/gemini-review-action@v1 
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          model: 'gemini-2.0-flash'
          system_instruction: |
            Aja como um Engenheiro de Segurança Sênior (DevSecOps).
            Analise o DIFF deste Pull Request e foque em:
            1. Vulnerabilidades OWASP Top 10 (especialmente SQL Injection e Insecure Deserialization).
            2. Code Smells e complexidade ciclomática desnecessária.
            3. Aderência às melhores práticas de Java 21+ e Spring Boot 3.4.
            4. Responda em Português com comentários técnicos e construtivos.